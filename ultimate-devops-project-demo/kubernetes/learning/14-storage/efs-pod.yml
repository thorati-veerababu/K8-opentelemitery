apiVersion: v1
kind: Pod
metadata:
  name: efs-writer
  labels:
    app: efs-demo
    role: writer
spec:
  containers:
    - name: writer
      image: busybox
      command:
        - /bin/sh
        - -c
        - |
          echo "=== EFS Writer Pod ==="
          echo "Writing to shared storage every 10 seconds..."
          while true; do
            TIMESTAMP=$(date)
            echo "[$TIMESTAMP] Written by efs-writer pod" >> /shared/log.txt
            echo "Wrote: $TIMESTAMP"
            sleep 10
          done
      
      volumeMounts:
        - name: shared-storage
          mountPath: /shared            # ðŸ‘ˆ Mounted at /shared
  
  volumes:
    - name: shared-storage
      persistentVolumeClaim:
        claimName: efs-claim            # ðŸ‘ˆ Uses the EFS PVC
---
# ============================================================
# POD 2: READER
# ============================================================
apiVersion: v1
kind: Pod
metadata:
  name: efs-reader
  labels:
    app: efs-demo
    role: reader
spec:
  containers:
    - name: reader
      image: busybox
      command:
        - /bin/sh
        - -c
        - |
          echo "=== EFS Reader Pod ==="
          echo "Reading from shared storage every 5 seconds..."
          sleep 15  # Wait for writer to create file
          while true; do
            echo "--- Current log contents ---"
            cat /shared/log.txt
            echo "--- End of log ---"
            echo ""
            sleep 5
          done
      
      volumeMounts:
        - name: shared-storage
          mountPath: /shared            # ðŸ‘ˆ Same mount path
  
  volumes:
    - name: shared-storage
      persistentVolumeClaim:
        claimName: efs-claim            # ðŸ‘ˆ Same PVC!