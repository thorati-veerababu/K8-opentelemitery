# ============================================================
# PERSISTENT VOLUME CLAIM (PVC) - Requesting Storage
# ============================================================
#
# üìö WHAT IS A PVC?
# -----------------
# A PVC is a "request" or "claim" for storage.
# Think of it like ordering food at a restaurant:
#   - You (Pod) say "I want a medium pizza" (PVC)
#   - The kitchen (StorageClass) makes it for you
#   - You get your pizza (PV - actual storage)
#
# The Pod never talks directly to storage - it only knows about the PVC.
# This separation allows:
#   ‚úÖ Developers: Just request what they need (5Gi, 10Gi)
#   ‚úÖ Admins: Control HOW storage is actually provisioned
#
# üîÑ LIFECYCLE:
#   1. PVC Created ‚Üí Status: "Pending"
#   2. StorageClass provisions volume ‚Üí PV Created
#   3. PVC binds to PV ‚Üí Status: "Bound"
#   4. Pod can now mount the PVC
#
# ============================================================

apiVersion: v1
kind: PersistentVolumeClaim

metadata:
  name: my-ebs-claim              # üëà Name that pods will reference
  namespace: default              # üëà PVCs are namespaced resources
  labels:
    app: storage-demo
    environment: learning

spec:
  # ============================================================
  # ACCESS MODES - How the volume can be accessed
  # ============================================================
  accessModes:
    - ReadWriteOnce               # üëà RWO = One node can mount read-write
                                   #
                                   # OPTIONS:
                                   # - ReadWriteOnce (RWO): One node, read-write
                                   #   ‚úÖ Use for: Databases, single-pod apps
                                   #   ‚ö†Ô∏è  EBS only supports this!
                                   #
                                   # - ReadOnlyMany (ROX): Many nodes, read-only
                                   #   ‚úÖ Use for: Shared config, static content
                                   #
                                   # - ReadWriteMany (RWX): Many nodes, read-write
                                   #   ‚úÖ Use for: Shared uploads, CMS
                                   #   ‚ö†Ô∏è  Requires EFS, not EBS!

  # ============================================================
  # STORAGE CLASS - Which template to use
  # ============================================================
  storageClassName: ebs-sc        # üëà References the StorageClass we created
                                   #    Must match: StorageClass.metadata.name
                                   #
                                   # If you set storageClassName: ""
                                   #   ‚Üí Kubernetes looks for a pre-existing PV
                                   #   ‚Üí No dynamic provisioning (static binding)

  # ============================================================
  # RESOURCES - How much storage to request
  # ============================================================
  resources:
    requests:
      storage: 5Gi                # üëà Request 5 Gibibytes
                                   #    Min for EBS: 1Gi
                                   #    Sizes: Ki, Mi, Gi, Ti (binary)
                                   #           K, M, G, T (decimal)
                                   #    
                                   # üí° TIP: Start small, expand later if needed
                                   #    (if allowVolumeExpansion: true in SC)

  # ============================================================
  # VOLUME MODE - How to expose the volume
  # ============================================================
  volumeMode: Filesystem          # üëà Mount as a filesystem (default)
                                   #
                                   # OPTIONS:
                                   # - Filesystem: Mount as directory (/data)
                                   #   ‚úÖ Most common, works with all apps
                                   #
                                   # - Block: Raw block device (/dev/xvda)
                                   #   ‚ö†Ô∏è  Advanced: For apps that manage own FS
                                   #   Example: Some databases, custom storage

  # ============================================================
  # SELECTOR (Optional) - Choose specific PV by labels
  # ============================================================
  # Use this for STATIC provisioning to bind to a specific PV
  # selector:
  #   matchLabels:
  #     type: ssd
  #     environment: production

# ============================================================
# üìä AFTER APPLYING, CHECK STATUS:
# ============================================================
#
# $ kubectl get pvc
# NAME           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS
# my-ebs-claim   Bound    pvc-abc123-def456-ghi789                   5Gi        RWO            ebs-sc
#
# STATUS meanings:
#   - Pending: Waiting for volume (PV) to be created
#   - Bound: Successfully connected to a PV ‚úÖ
#   - Lost: The PV was deleted but PVC still exists
#
# ============================================================
# üîç TROUBLESHOOTING:
# ============================================================
#
# If PVC stays "Pending", check:
#   $ kubectl describe pvc my-ebs-claim
#
# Common issues:
#   1. "no persistent volumes available" 
#      ‚Üí StorageClass name mismatch or CSI not installed
#
#   2. "waiting for first consumer"
#      ‚Üí Normal! Volume creates when Pod uses it
#      ‚Üí (Because volumeBindingMode: WaitForFirstConsumer)
#
# ============================================================
